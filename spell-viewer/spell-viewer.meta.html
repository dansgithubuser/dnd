<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01//EN'>
<html manifest="spell-viewer.appcache"><!-- offline javascript on mobile -->
	<head>
		<meta name="viewport" content="width=device-width"><!-- responsive UI on mobile -->
		<script type='text/javascript'>

//only tested with chrome and LG4 browser

/*\
with open(os.path.join('..', 'spells.json')) as file: contents=file.read()
contents=contents.replace('\\n', '<br>')
contents=contents.replace('\\', '\\\\')
contents=contents.replace("'", r"\'")
result="SPELLS='{}'".format(contents)
\*/
SPELLS=JSON.parse(SPELLS)
CURRENT_SPELL_NAME=''
KEEP=[]

function e(name){ return document.getElementById(name) }
function v(name){ return e(name).value }

function keep(){
	if(e('keep').checked) KEEP.push(CURRENT_SPELL_NAME)
	else{
		i=KEEP.indexOf(CURRENT_SPELL_NAME)
		if(i>=0) KEEP.splice(i, 1)
	}
}

function update(){
	setTimeout(function(){
		list=e('list')
		while(list.hasChildNodes()) list.removeChild(list.lastChild)
		filtered=[]
		for(spellName in SPELLS) if(SPELLS.hasOwnProperty(spellName)){
			spell=SPELLS[spellName]
			if(KEEP.indexOf(spellName)==-1){
				if(!e('level '+spell.level).checked) continue
				classes=spell.classes
				good=false
				for(i in classes) if(e(classes[i]).checked) good=true
				if(!good) continue
				spell.name=spellName
			}
			filtered.push(spell)
		}
		filtered.sort(function(a, b){
			if(a.level<b.level) return -1
			if(a.level>b.level) return 1
			if(a.name<b.name) return -1
			if(a.name>b.name) return 1
			return 0
		})
		for(i in filtered){
			spell=filtered[i]
			div=document.createElement('div')
			div.innerHTML=spell.name
			f=function(){
				var list=[]
				for(i in spell) if(spell.hasOwnProperty(i)) list.push([i, spell[i]])
				order=[
					'name',
					'level',
					'school',
					'casting time',
					'range',
					'components',
					'duration',
					'description',
					'-',
					'at higher levels',
					'classes',
				]
				list.sort(function(a, b){
					x=order.indexOf(a[0])
					if(x==-1) x=order.indexOf('-')
					y=order.indexOf(b[0])
					if(y==-1) y=order.indexOf('-')
					if(x<y) return -1
					if(x==y) return 0
					if(x>y) return 1
				})
				var x=''
				for(i in list){
					if(order.slice(0, 7).indexOf(list[i][0])==-1) x+='<br>'
					x+='<b>'+list[i][0]+'</b>: '+list[i][1]+'<br>'
				}
				for(i=0; i<10; ++i) x+='<br>'
				var y=spell.name
				div.onclick=function(){
					e('details').innerHTML=x
					CURRENT_SPELL_NAME=y
					e('keep').checked=KEEP.indexOf(y)!=-1
				}
			}
			f()
			list.appendChild(div)
		}
	})
}

		</script>
	</head>
	<body>
	/*\
	checkables=[
		['bard', 'cleric', 'druid', 'paladin', 'ranger', 'sorcerer', 'warlock', 'wizard'],
		['level {}'.format(i) for i in range(10)],
	]
	extra=[
		'<br><label><input type="checkbox" id="keep" onClick="keep()">keep</label>',
		''
	]
	for i in range(len(checkables)):
		result+='<div style="float: left">\n'
		for j in checkables[i]:
			result+='<label><input type="checkbox" id="{0}" onClick="update()">{0}</label><br>\n'.format(j)
		result+=extra[i]
		result+='</div>\n'
	\*/
	<br style="clear: left;"/>
	<div id="list" style="width: 46%"></div>
	<br style="clear: left;"/>
	<div id="details" style="position: fixed; top: 2%; right: 2%; width: 46%; height: 100%; overflow: scroll"></div>
	</body>
</html>
